/*! For license information please see app.bundle.js.LICENSE.txt */
(()=>{"use strict";var t={298:(t,e,r)=>{r.d(e,{A:()=>p});var n=r(389),o=function(t){return{id:t.id,name:t.name,description:t.description,photoUrl:t.photoUrl||t.photo||"",createdAt:t.createdAt,lat:t.lat,lon:t.lon}},i=r(659);function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(t)}function c(){c=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function f(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{f({},"")}catch(t){f=function(t,e,r){return t[e]=r}}function h(t,e,r,n){var i=e&&e.prototype instanceof w?e:w,a=Object.create(i.prototype),c=new C(n||[]);return o(a,"_invoke",{value:P(t,r,c)}),a}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var d="suspendedStart",v="suspendedYield",y="executing",m="completed",g={};function w(){}function b(){}function x(){}var L={};f(L,s,(function(){return this}));var k=Object.getPrototypeOf,E=k&&k(k(N([])));E&&E!==r&&n.call(E,s)&&(L=E);var _=x.prototype=w.prototype=Object.create(L);function S(t){["next","throw","return"].forEach((function(e){f(t,e,(function(t){return this._invoke(e,t)}))}))}function O(t,e){function r(o,i,c,s){var u=p(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==a(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,c,s)}),(function(t){r("throw",t,c,s)})):e.resolve(f).then((function(t){l.value=t,c(l)}),(function(t){return r("throw",t,c,s)}))}s(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function P(e,r,n){var o=d;return function(i,a){if(o===y)throw Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=j(c,n);if(s){if(s===g)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var u=p(e,r,n);if("normal"===u.type){if(o=n.done?m:v,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=m,n.method="throw",n.arg=u.arg)}}}function j(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,j(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=p(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[s];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(a(e)+" is not iterable")}return b.prototype=x,o(_,"constructor",{value:x,configurable:!0}),o(x,"constructor",{value:b,configurable:!0}),b.displayName=f(x,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,f(t,l,"GeneratorFunction")),t.prototype=Object.create(_),t},e.awrap=function(t){return{__await:t}},S(O.prototype),f(O.prototype,u,(function(){return this})),e.AsyncIterator=O,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new O(h(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},S(_),f(_,l,"Generator"),f(_,s,(function(){return this})),f(_,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),I(r),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;I(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}function s(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function u(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){s(i,n,o,a,c,"next",t)}function c(t){s(i,n,o,a,c,"throw",t)}a(void 0)}))}}function l(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,f(n.key),n)}}function f(t){var e=function(t){if("object"!=a(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=a(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==a(e)?e:e+""}var h={REGISTER:"".concat(n.A.BASE_URL,"/register"),LOGIN:"".concat(n.A.BASE_URL,"/login"),STORIES:"".concat(n.A.BASE_URL,"/stories"),STORIES_GUEST:"".concat(n.A.BASE_URL,"/stories/guest"),STORY_DETAIL:function(t){return"".concat(n.A.BASE_URL,"/stories/").concat(t)},NOTIFICATION_SUBSCRIBE:"".concat(n.A.BASE_URL,"/notifications/subscribe")};const p=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},e=[{key:"register",value:(b=u(c().mark((function t(e){var r,n,o,i,a;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.name,n=e.email,o=e.password,t.next=3,fetch(h.REGISTER,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:r,email:n,password:o})});case 3:return i=t.sent,t.next=6,i.json();case 6:if(!(a=t.sent).error){t.next=9;break}throw new Error(a.message);case 9:return t.abrupt("return",a);case 10:case"end":return t.stop()}}),t)}))),function(t){return b.apply(this,arguments)})},{key:"login",value:(w=u(c().mark((function t(e){var r,n,o,i;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.email,n=e.password,t.next=3,fetch(h.LOGIN,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:r,password:n})});case 3:return o=t.sent,t.next=6,o.json();case 6:if(!(i=t.sent).error){t.next=9;break}throw new Error(i.message);case 9:return t.abrupt("return",i);case 10:case"end":return t.stop()}}),t)}))),function(t){return w.apply(this,arguments)})},{key:"getAllStories",value:(g=u(c().mark((function t(e){var r,n,a,s,u,l,f,p,d,v,y,m,g,w,b,x;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.page,n=void 0===r?1:r,a=e.size,s=void 0===a?10:a,u=e.location,l=void 0===u?0:u,f=e.token,(void 0===(p=e.useOffline)||!p)&&navigator.onLine){t.next=14;break}return t.prev=2,console.log("📱 Loading stories from IndexedDB (offline mode)"),t.next=6,i.A.getAllStories();case 6:return d=t.sent,t.abrupt("return",d);case 10:throw t.prev=10,t.t0=t.catch(2),console.error("Failed to load stories from IndexedDB:",t.t0),new Error("Unable to load stories offline");case 14:return t.prev=14,v="".concat(h.STORIES,"?page=").concat(n,"&size=").concat(s,"&location=").concat(l),y={},f?y.Authorization="Bearer ".concat(f):v="".concat(h.STORIES_GUEST,"?page=").concat(n,"&size=").concat(s,"&location=").concat(l),t.next=20,fetch(v,{method:"GET",headers:y});case 20:return m=t.sent,t.next=23,m.json();case 23:if(!(g=t.sent).error){t.next=26;break}throw new Error(g.message);case 26:return w=g.listStory||g.stories||[],b=w.map(o),t.prev=28,t.next=31,i.A.saveStories(b);case 31:console.log("💾 Stories saved to IndexedDB for offline access"),t.next=37;break;case 34:t.prev=34,t.t1=t.catch(28),console.warn("Failed to save stories to IndexedDB:",t.t1);case 37:return t.abrupt("return",b);case 40:return t.prev=40,t.t2=t.catch(14),console.warn("API request failed, trying IndexedDB fallback:",t.t2.message),t.prev=43,t.next=46,i.A.getAllStories();case 46:if(!((x=t.sent).length>0)){t.next=50;break}return console.log("📱 Loaded stories from IndexedDB as fallback"),t.abrupt("return",x);case 50:t.next=55;break;case 52:t.prev=52,t.t3=t.catch(43),console.error("IndexedDB fallback also failed:",t.t3);case 55:throw t.t2;case 56:case"end":return t.stop()}}),t,null,[[2,10],[14,40],[28,34],[43,52]])}))),function(t){return g.apply(this,arguments)})},{key:"getStoryDetail",value:(m=u(c().mark((function t(e,r){var n,a,s,u,l,f,p=arguments;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(p.length>2&&void 0!==p[2]&&p[2])&&navigator.onLine){t.next=16;break}return t.prev=2,console.log("📱 Loading story ".concat(e," from IndexedDB (offline mode)")),t.next=6,i.A.getStoryById(e);case 6:if(n=t.sent){t.next=9;break}throw new Error("Story not found in offline storage");case 9:return t.abrupt("return",n);case 12:throw t.prev=12,t.t0=t.catch(2),console.error("Failed to load story from IndexedDB:",t.t0),new Error("Unable to load story offline");case 16:if(t.prev=16,r){t.next=19;break}throw new Error("Authentication token is missing");case 19:return t.next=21,fetch(h.STORY_DETAIL(e),{method:"GET",headers:{Authorization:"Bearer ".concat(r)}});case 21:return a=t.sent,t.next=24,a.json();case 24:if(!(s=t.sent).error){t.next=27;break}throw new Error(s.message);case 27:return u=s.story||s.data||{},l=o(u),t.prev=29,t.next=32,i.A.saveStory(l);case 32:console.log("💾 Story ".concat(e," saved to IndexedDB for offline access")),t.next=38;break;case 35:t.prev=35,t.t1=t.catch(29),console.warn("Failed to save story to IndexedDB:",t.t1);case 38:return t.abrupt("return",l);case 41:return t.prev=41,t.t2=t.catch(16),console.warn("API request failed, trying IndexedDB fallback:",t.t2.message),t.prev=44,t.next=47,i.A.getStoryById(e);case 47:if(!(f=t.sent)){t.next=51;break}return console.log("📱 Loaded story ".concat(e," from IndexedDB as fallback")),t.abrupt("return",f);case 51:t.next=56;break;case 53:t.prev=53,t.t3=t.catch(44),console.error("IndexedDB fallback also failed:",t.t3);case 56:throw t.t2;case 57:case"end":return t.stop()}}),t,null,[[2,12],[16,41],[29,35],[44,53]])}))),function(t,e){return m.apply(this,arguments)})},{key:"addNewStory",value:(y=u(c().mark((function t(e,r){var n,o,i,a,s,u,l;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.description,o=e.photo,i=e.lat,a=e.lon,r){t.next=3;break}throw new Error("Authentication token is missing");case 3:return(s=new FormData).append("description",n),s.append("photo",o),i&&a&&(s.append("lat",i),s.append("lon",a)),t.next=9,fetch(h.STORIES,{method:"POST",headers:{Authorization:"Bearer ".concat(r)},body:s});case 9:return u=t.sent,t.next=12,u.json();case 12:if(!(l=t.sent).error){t.next=15;break}throw new Error(l.message);case 15:return t.abrupt("return",l);case 16:case"end":return t.stop()}}),t)}))),function(t,e){return y.apply(this,arguments)})},{key:"addNewStoryGuest",value:(v=u(c().mark((function t(e){var r,n,o,i,a,s,u;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.description,n=e.photo,o=e.lat,i=e.lon,(a=new FormData).append("description",r),a.append("photo",n),o&&i&&(a.append("lat",o),a.append("lon",i)),t.next=7,fetch(h.STORIES_GUEST,{method:"POST",body:a});case 7:return s=t.sent,t.next=10,s.json();case 10:if(!(u=t.sent).error){t.next=13;break}throw new Error(u.message);case 13:return t.abrupt("return",u);case 14:case"end":return t.stop()}}),t)}))),function(t){return v.apply(this,arguments)})},{key:"subscribePushNotification",value:(d=u(c().mark((function t(e,r){var n,o,i,a;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.endpoint,o=e.keys,r){t.next=3;break}throw new Error("Authentication token is missing");case 3:return t.next=5,fetch(h.NOTIFICATION_SUBSCRIBE,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},body:JSON.stringify({endpoint:n,keys:o})});case 5:return i=t.sent,t.next=8,i.json();case 8:if(!(a=t.sent).error){t.next=11;break}throw new Error(a.message);case 11:return t.abrupt("return",a);case 12:case"end":return t.stop()}}),t)}))),function(t,e){return d.apply(this,arguments)})},{key:"unsubscribePushNotification",value:(p=u(c().mark((function t(e,r){var n,o,i;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.endpoint,r){t.next=3;break}throw new Error("Authentication token is missing");case 3:return t.next=5,fetch(h.NOTIFICATION_SUBSCRIBE,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},body:JSON.stringify({endpoint:n})});case 5:return o=t.sent,t.next=8,o.json();case 8:if(!(i=t.sent).error){t.next=11;break}throw new Error(i.message);case 11:return t.abrupt("return",i);case 12:case"end":return t.stop()}}),t)}))),function(t,e){return p.apply(this,arguments)})},{key:"getOfflineStories",value:(f=u(c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,i.A.getAllStories();case 3:return t.abrupt("return",t.sent);case 6:return t.prev=6,t.t0=t.catch(0),console.error("Failed to get offline stories:",t.t0),t.abrupt("return",[]);case 10:case"end":return t.stop()}}),t,null,[[0,6]])}))),function(){return f.apply(this,arguments)})},{key:"deleteOfflineStory",value:(s=u(c().mark((function t(e){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,i.A.deleteStory(e);case 3:return t.abrupt("return",t.sent);case 6:throw t.prev=6,t.t0=t.catch(0),console.error("Failed to delete offline story:",t.t0),t.t0;case 10:case"end":return t.stop()}}),t,null,[[0,6]])}))),function(t){return s.apply(this,arguments)})},{key:"clearOfflineStories",value:(a=u(c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,i.A.deleteAllStories();case 3:return t.abrupt("return",t.sent);case 6:throw t.prev=6,t.t0=t.catch(0),console.error("Failed to clear offline stories:",t.t0),t.t0;case 10:case"end":return t.stop()}}),t,null,[[0,6]])}))),function(){return a.apply(this,arguments)})},{key:"getOfflineStoriesCount",value:(n=u(c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,i.A.getStoriesCount();case 3:return t.abrupt("return",t.sent);case 6:return t.prev=6,t.t0=t.catch(0),console.error("Failed to get offline stories count:",t.t0),t.abrupt("return",0);case 10:case"end":return t.stop()}}),t,null,[[0,6]])}))),function(){return n.apply(this,arguments)})},{key:"searchOfflineStories",value:(r=u(c().mark((function t(e){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,i.A.searchStories(e);case 3:return t.abrupt("return",t.sent);case 6:return t.prev=6,t.t0=t.catch(0),console.error("Failed to search offline stories:",t.t0),t.abrupt("return",[]);case 10:case"end":return t.stop()}}),t,null,[[0,6]])}))),function(t){return r.apply(this,arguments)})}],e&&l(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n,a,s,f,p,d,v,y,m,g,w,b}()},319:(t,e,r)=>{r.d(e,{O5:()=>i,aX:()=>s,c4:()=>a,gV:()=>c}),r(754);var n="user",o="token";function i(t){if(!t)throw new Error("Token is required");localStorage.setItem(o,t)}function a(){return localStorage.getItem(o)}function c(t){if(!t)throw new Error("User data is required");localStorage.setItem(n,JSON.stringify(t))}function s(){var t=document.getElementById("auth-links");if(t){var e=a(),r=function(){var t=localStorage.getItem(n);return t?JSON.parse(t):null}();if(t.innerHTML,e&&r){t.innerHTML='\n      <li><span class="nav-user">Hello, '.concat(r.name,'</span></li>\n      <li><a href="#" id="logout">Logout</a></li>\n    ');var i=document.getElementById("logout");i&&i.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),console.log("Logout clicked"),localStorage.removeItem(o),localStorage.removeItem(n),window.location.hash="#/",window.location.reload()}))}else t.innerHTML='\n      <li><a href="#/login">Login</a></li>\n      <li><a href="#/register">Register</a></li>\n    '}}},389:(t,e,r)=>{r.d(e,{A:()=>n});const n={BASE_URL:"https://story-api.dicoding.dev/v1",DEFAULT_LANGUAGE:"en-us",CACHE_NAME:"StoryApp-V1",DATABASE_NAME:"story-app-database",DATABASE_VERSION:1,OBJECT_STORE_NAME:"stories",MAP_SERVICE_API_KEY:"qlGqJvL5mR3sLG4PsCea",VAPID_PUBLIC_KEY:"BCCs2eonMI-6H2ctvFaWg-UYdDv387Vno_bzUzALpB442r2lCnsHmtrx8biyPi_E-1fSGABK_Qs_GlvPoJJqxbk"}},639:(t,e,r)=>{r.r(e),r.d(e,{createNotificationToggle:()=>c,initNotificationToggle:()=>s});var n=r(754);function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function i(){i=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,a=Object.defineProperty||function(t,e,r){t[e]=r.value},c="function"==typeof Symbol?Symbol:{},s=c.iterator||"@@iterator",u=c.asyncIterator||"@@asyncIterator",l=c.toStringTag||"@@toStringTag";function f(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{f({},"")}catch(t){f=function(t,e,r){return t[e]=r}}function h(t,e,r,n){var o=e&&e.prototype instanceof w?e:w,i=Object.create(o.prototype),c=new C(n||[]);return a(i,"_invoke",{value:P(t,r,c)}),i}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var d="suspendedStart",v="suspendedYield",y="executing",m="completed",g={};function w(){}function b(){}function x(){}var L={};f(L,s,(function(){return this}));var k=Object.getPrototypeOf,E=k&&k(k(N([])));E&&E!==r&&n.call(E,s)&&(L=E);var _=x.prototype=w.prototype=Object.create(L);function S(t){["next","throw","return"].forEach((function(e){f(t,e,(function(t){return this._invoke(e,t)}))}))}function O(t,e){function r(i,a,c,s){var u=p(t[i],t,a);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==o(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,c,s)}),(function(t){r("throw",t,c,s)})):e.resolve(f).then((function(t){l.value=t,c(l)}),(function(t){return r("throw",t,c,s)}))}s(u.arg)}var i;a(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function P(e,r,n){var o=d;return function(i,a){if(o===y)throw Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=j(c,n);if(s){if(s===g)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var u=p(e,r,n);if("normal"===u.type){if(o=n.done?m:v,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=m,n.method="throw",n.arg=u.arg)}}}function j(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,j(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=p(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[s];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(o(e)+" is not iterable")}return b.prototype=x,a(_,"constructor",{value:x,configurable:!0}),a(x,"constructor",{value:b,configurable:!0}),b.displayName=f(x,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,f(t,l,"GeneratorFunction")),t.prototype=Object.create(_),t},e.awrap=function(t){return{__await:t}},S(O.prototype),f(O.prototype,u,(function(){return this})),e.AsyncIterator=O,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new O(h(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},S(_),f(_,l,"Generator"),f(_,s,(function(){return this})),f(_,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),I(r),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;I(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}function a(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function c(){var t=(0,n.An)();return'\n    <div class="notification-toggle">\n      <button \n        id="notification-toggle-btn" \n        class="notification-btn '.concat(t?"active":"",'" \n        title="').concat(t?"Nonaktifkan Notifikasi":"Aktifkan Notifikasi",'"\n        aria-label="Toggle Push Notification"\n      >\n        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n          ').concat(t?'<path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>\n             <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>':'<path d="M13.73 21a2 2 0 0 1-3.46 0"></path>\n             <path d="M18.63 13A17.89 17.89 0 0 1 18 8"></path>\n             <path d="M6.37 13A17.89 17.89 0 0 0 6 8a6 6 0 0 1 10.44-4.16"></path>\n             <line x1="1" y1="1" x2="23" y2="23"></line>','\n        </svg>\n        <span class="notification-status">').concat(t?"ON":"OFF","</span>\n      </button>\n    </div>\n  ")}function s(){var t=document.getElementById("notification-toggle-btn");if(t){var e=t.cloneNode(!0);t.parentNode.replaceChild(e,t),e.addEventListener("click",function(){var t,r=(t=i().mark((function t(r){return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.preventDefault(),e.disabled=!0,e.classList.add("loading"),t.prev=3,!(0,n.An)()){t.next=12;break}return t.next=8,(0,n.rd)();case 8:t.sent&&u(!1),t.next=16;break;case 12:return t.next=14,(0,n.$R)();case 14:t.sent&&u(!0);case 16:t.next=21;break;case 18:t.prev=18,t.t0=t.catch(3),console.error("Error toggling notification:",t.t0);case 21:return t.prev=21,e.disabled=!1,e.classList.remove("loading"),t.finish(21);case 25:case"end":return t.stop()}}),t,null,[[3,18,21,25]])})),function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function c(t){a(i,n,o,c,s,"next",t)}function s(t){a(i,n,o,c,s,"throw",t)}c(void 0)}))});return function(t){return r.apply(this,arguments)}}())}else console.warn("Notification toggle button not found")}function u(t){var e=document.getElementById("notification-toggle-btn");if(e){var r=e.querySelector(".notification-status"),n=e.querySelector("svg");t?(e.classList.add("active"),e.title="Nonaktifkan Notifikasi",r&&(r.textContent="ON"),n&&(n.innerHTML='\n        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>\n        <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>\n      ')):(e.classList.remove("active"),e.title="Aktifkan Notifikasi",r&&(r.textContent="OFF"),n&&(n.innerHTML='\n        <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>\n        <path d="M18.63 13A17.89 17.89 0 0 1 18 8"></path>\n        <path d="M6.37 13A17.89 17.89 0 0 0 6 8a6 6 0 0 1 10.44-4.16"></path>\n        <line x1="1" y1="1" x2="23" y2="23"></line>\n      '))}}},659:(t,e,r)=>{function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function o(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function i(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?o(Object(r),!0).forEach((function(e){a(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function a(t,e,r){return(e=f(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function c(){c=function(){return e};var t,e={},r=Object.prototype,o=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",u=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function f(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{f({},"")}catch(t){f=function(t,e,r){return t[e]=r}}function h(t,e,r,n){var o=e&&e.prototype instanceof w?e:w,a=Object.create(o.prototype),c=new C(n||[]);return i(a,"_invoke",{value:P(t,r,c)}),a}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var d="suspendedStart",v="suspendedYield",y="executing",m="completed",g={};function w(){}function b(){}function x(){}var L={};f(L,s,(function(){return this}));var k=Object.getPrototypeOf,E=k&&k(k(N([])));E&&E!==r&&o.call(E,s)&&(L=E);var _=x.prototype=w.prototype=Object.create(L);function S(t){["next","throw","return"].forEach((function(e){f(t,e,(function(t){return this._invoke(e,t)}))}))}function O(t,e){function r(i,a,c,s){var u=p(t[i],t,a);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==n(f)&&o.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,c,s)}),(function(t){r("throw",t,c,s)})):e.resolve(f).then((function(t){l.value=t,c(l)}),(function(t){return r("throw",t,c,s)}))}s(u.arg)}var a;i(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return a=a?a.then(o,o):o()}})}function P(e,r,n){var o=d;return function(i,a){if(o===y)throw Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=j(c,n);if(s){if(s===g)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var u=p(e,r,n);if("normal"===u.type){if(o=n.done?m:v,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=m,n.method="throw",n.arg=u.arg)}}}function j(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,j(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=p(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[s];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function r(){for(;++i<e.length;)if(o.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(n(e)+" is not iterable")}return b.prototype=x,i(_,"constructor",{value:x,configurable:!0}),i(x,"constructor",{value:b,configurable:!0}),b.displayName=f(x,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,f(t,l,"GeneratorFunction")),t.prototype=Object.create(_),t},e.awrap=function(t){return{__await:t}},S(O.prototype),f(O.prototype,u,(function(){return this})),e.AsyncIterator=O,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new O(h(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},S(_),f(_,l,"Generator"),f(_,s,(function(){return this})),f(_,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=o.call(a,"catchLoc"),u=o.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),I(r),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;I(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}function s(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function u(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){s(i,n,o,a,c,"next",t)}function c(t){s(i,n,o,a,c,"throw",t)}a(void 0)}))}}function l(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,f(n.key),n)}}function f(t){var e=function(t){if("object"!=n(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==n(e)?e:e+""}r.d(e,{A:()=>d});var h="StoryAppDB",p="stories";const d=new(function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.db=null},e=[{key:"init",value:(g=u(c().mark((function t(){var e=this;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,r){var n=indexedDB.open(h,1);n.onerror=function(){r(new Error("Failed to open IndexedDB"))},n.onsuccess=function(r){e.db=r.target.result,t(e.db)},n.onupgradeneeded=function(t){var e=t.target.result;if(!e.objectStoreNames.contains(p)){var r=e.createObjectStore(p,{keyPath:"id",autoIncrement:!1});r.createIndex("createdAt","createdAt",{unique:!1}),r.createIndex("name","name",{unique:!1})}}})));case 1:case"end":return t.stop()}}),t)}))),function(){return g.apply(this,arguments)})},{key:"saveStories",value:(m=u(c().mark((function t(e){var r=this;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.db){t.next=3;break}return t.next=3,this.init();case 3:return t.abrupt("return",new Promise((function(t,n){var o=r.db.transaction([p],"readwrite"),a=o.objectStore(p),c=0,s=e.length;0!==s?(e.forEach((function(r){var o=i(i({},r),{},{savedAt:(new Date).toISOString(),isOffline:!0}),u=a.put(o);u.onsuccess=function(){++c===s&&t(e)},u.onerror=function(){n(new Error("Failed to save story: ".concat(r.id)))}})),o.onerror=function(){n(new Error("Transaction failed while saving stories"))}):t([])})));case 4:case"end":return t.stop()}}),t,this)}))),function(t){return m.apply(this,arguments)})},{key:"saveStory",value:(y=u(c().mark((function t(e){var r=this;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.db){t.next=3;break}return t.next=3,this.init();case 3:return t.abrupt("return",new Promise((function(t,n){var o=r.db.transaction([p],"readwrite").objectStore(p),a=i(i({},e),{},{savedAt:(new Date).toISOString(),isOffline:!0}),c=o.put(a);c.onsuccess=function(){t(a)},c.onerror=function(){n(new Error("Failed to save story: ".concat(e.id)))}})));case 4:case"end":return t.stop()}}),t,this)}))),function(t){return y.apply(this,arguments)})},{key:"getAllStories",value:(v=u(c().mark((function t(){var e=this;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.db){t.next=3;break}return t.next=3,this.init();case 3:return t.abrupt("return",new Promise((function(t,r){var n=e.db.transaction([p],"readonly").objectStore(p).getAll();n.onsuccess=function(){var e=n.result||[];e.sort((function(t,e){return new Date(e.createdAt)-new Date(t.createdAt)})),t(e)},n.onerror=function(){r(new Error("Failed to retrieve stories from IndexedDB"))}})));case 4:case"end":return t.stop()}}),t,this)}))),function(){return v.apply(this,arguments)})},{key:"getStoryById",value:(d=u(c().mark((function t(e){var r=this;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.db){t.next=3;break}return t.next=3,this.init();case 3:return t.abrupt("return",new Promise((function(t,n){var o=r.db.transaction([p],"readonly").objectStore(p).get(e);o.onsuccess=function(){t(o.result||null)},o.onerror=function(){n(new Error("Failed to retrieve story with ID: ".concat(e)))}})));case 4:case"end":return t.stop()}}),t,this)}))),function(t){return d.apply(this,arguments)})},{key:"deleteStory",value:(f=u(c().mark((function t(e){var r=this;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.db){t.next=3;break}return t.next=3,this.init();case 3:return t.abrupt("return",new Promise((function(t,n){var o=r.db.transaction([p],"readwrite").objectStore(p).delete(e);o.onsuccess=function(){t(!0)},o.onerror=function(){n(new Error("Failed to delete story with ID: ".concat(e)))}})));case 4:case"end":return t.stop()}}),t,this)}))),function(t){return f.apply(this,arguments)})},{key:"deleteAllStories",value:(s=u(c().mark((function t(){var e=this;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.db){t.next=3;break}return t.next=3,this.init();case 3:return t.abrupt("return",new Promise((function(t,r){var n=e.db.transaction([p],"readwrite").objectStore(p).clear();n.onsuccess=function(){t(!0)},n.onerror=function(){r(new Error("Failed to clear all stories"))}})));case 4:case"end":return t.stop()}}),t,this)}))),function(){return s.apply(this,arguments)})},{key:"getStoriesCount",value:(a=u(c().mark((function t(){var e=this;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.db){t.next=3;break}return t.next=3,this.init();case 3:return t.abrupt("return",new Promise((function(t,r){var n=e.db.transaction([p],"readonly").objectStore(p).count();n.onsuccess=function(){t(n.result)},n.onerror=function(){r(new Error("Failed to count stories"))}})));case 4:case"end":return t.stop()}}),t,this)}))),function(){return a.apply(this,arguments)})},{key:"searchStories",value:(o=u(c().mark((function t(e){var r,n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.db){t.next=3;break}return t.next=3,this.init();case 3:return t.next=5,this.getAllStories();case 5:return r=t.sent,n=e.toLowerCase(),t.abrupt("return",r.filter((function(t){return t.name.toLowerCase().includes(n)||t.description.toLowerCase().includes(n)})));case 8:case"end":return t.stop()}}),t,this)}))),function(t){return o.apply(this,arguments)})},{key:"getDBInfo",value:(n=u(c().mark((function t(){var e;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getStoriesCount();case 2:return e=t.sent,t.abrupt("return",{name:h,version:1,storiesCount:e,isConnected:!!this.db});case 4:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})}],r=[{key:"isSupported",value:function(){return"indexedDB"in window}}],e&&l(t.prototype,e),r&&l(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n,o,a,s,f,d,v,y,m,g}())},754:(t,e,r)=>{r.d(e,{$R:()=>y,An:()=>b,GF:()=>f,Ni:()=>l,rd:()=>g});var n=r(389),o=r(298),i=r(319);function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(t)}function c(){c=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function f(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{f({},"")}catch(t){f=function(t,e,r){return t[e]=r}}function h(t,e,r,n){var i=e&&e.prototype instanceof w?e:w,a=Object.create(i.prototype),c=new C(n||[]);return o(a,"_invoke",{value:P(t,r,c)}),a}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var d="suspendedStart",v="suspendedYield",y="executing",m="completed",g={};function w(){}function b(){}function x(){}var L={};f(L,s,(function(){return this}));var k=Object.getPrototypeOf,E=k&&k(k(N([])));E&&E!==r&&n.call(E,s)&&(L=E);var _=x.prototype=w.prototype=Object.create(L);function S(t){["next","throw","return"].forEach((function(e){f(t,e,(function(t){return this._invoke(e,t)}))}))}function O(t,e){function r(o,i,c,s){var u=p(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==a(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,c,s)}),(function(t){r("throw",t,c,s)})):e.resolve(f).then((function(t){l.value=t,c(l)}),(function(t){return r("throw",t,c,s)}))}s(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function P(e,r,n){var o=d;return function(i,a){if(o===y)throw Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=j(c,n);if(s){if(s===g)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var u=p(e,r,n);if("normal"===u.type){if(o=n.done?m:v,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=m,n.method="throw",n.arg=u.arg)}}}function j(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,j(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=p(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[s];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(a(e)+" is not iterable")}return b.prototype=x,o(_,"constructor",{value:x,configurable:!0}),o(x,"constructor",{value:b,configurable:!0}),b.displayName=f(x,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,f(t,l,"GeneratorFunction")),t.prototype=Object.create(_),t},e.awrap=function(t){return{__await:t}},S(O.prototype),f(O.prototype,u,(function(){return this})),e.AsyncIterator=O,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new O(h(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},S(_),f(_,l,"Generator"),f(_,s,(function(){return this})),f(_,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),I(r),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;I(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}function s(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function u(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){s(i,n,o,a,c,"next",t)}function c(t){s(i,n,o,a,c,"throw",t)}a(void 0)}))}}function l(t){var e=document.createElement("div");e.className="toast error",e.textContent=t,document.body.appendChild(e),setTimeout((function(){e.classList.add("show")}),10),setTimeout((function(){e.classList.remove("show"),setTimeout((function(){document.body.removeChild(e)}),300)}),3e3)}function f(t){var e=document.createElement("div");e.className="toast success",e.textContent=t,document.body.appendChild(e),setTimeout((function(){e.classList.add("show")}),10),setTimeout((function(){e.classList.remove("show"),setTimeout((function(){document.body.removeChild(e)}),300)}),3e3)}function h(){return p.apply(this,arguments)}function p(){return(p=u(c().mark((function t(){var e;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("Notification"in window){t.next=3;break}return console.warn("Browser tidak mendukung push notification"),t.abrupt("return",!1);case 3:if("default"!==(e=Notification.permission)){t.next=8;break}return t.next=7,Notification.requestPermission();case 7:e=t.sent;case 8:if("granted"!==e){t.next=13;break}return console.log("Permission untuk notifikasi diberikan"),t.abrupt("return",!0);case 13:return console.warn("Permission untuk notifikasi ditolak"),l("Permission untuk notifikasi diperlukan untuk mendapatkan update terbaru"),t.abrupt("return",!1);case 16:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function d(){return v.apply(this,arguments)}function v(){return(v=u(c().mark((function t(){var e;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("serviceWorker"in navigator){t.next=3;break}return console.warn("Service Worker tidak didukung browser"),t.abrupt("return",null);case 3:return t.prev=3,t.next=6,navigator.serviceWorker.register("/sw.js",{scope:"/"});case 6:return e=t.sent,console.log("Service Worker berhasil didaftarkan:",e),t.abrupt("return",e);case 11:return t.prev=11,t.t0=t.catch(3),console.error("Gagal mendaftarkan Service Worker:",t.t0),t.abrupt("return",null);case 15:case"end":return t.stop()}}),t,null,[[3,11]])})))).apply(this,arguments)}function y(){return m.apply(this,arguments)}function m(){return(m=u(c().mark((function t(){var e,r,a,s,u;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e=(0,i.c4)()){t.next=5;break}return console.warn("User belum login, tidak bisa subscribe push notification"),t.abrupt("return",!1);case 5:return t.next=7,h();case 7:if(t.sent){t.next=10;break}return t.abrupt("return",!1);case 10:return t.next=12,d();case 12:if(r=t.sent){t.next=16;break}return l("Gagal mendaftarkan Service Worker"),t.abrupt("return",!1);case 16:return t.next=18,navigator.serviceWorker.ready;case 18:return a=x(n.A.VAPID_PUBLIC_KEY),t.next=21,r.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:a});case 21:return s=t.sent,console.log("Push subscription berhasil:",s),u={endpoint:s.endpoint,keys:{p256dh:L(s.getKey("p256dh")),auth:L(s.getKey("auth"))}},t.next=26,o.A.subscribePushNotification(u,e);case 26:return f("Berhasil mengaktifkan push notification"),localStorage.setItem("push_subscription_active","true"),t.abrupt("return",!0);case 31:return t.prev=31,t.t0=t.catch(0),console.error("Error subscribing to push notification:",t.t0),l("Gagal mengaktifkan push notification: "+t.t0.message),t.abrupt("return",!1);case 36:case"end":return t.stop()}}),t,null,[[0,31]])})))).apply(this,arguments)}function g(){return w.apply(this,arguments)}function w(){return(w=u(c().mark((function t(){var e,r,n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e=(0,i.c4)()){t.next=5;break}return console.warn("User belum login"),t.abrupt("return",!1);case 5:return t.next=7,navigator.serviceWorker.getRegistration();case 7:if(r=t.sent){t.next=11;break}return console.warn("Service Worker tidak ditemukan"),t.abrupt("return",!1);case 11:return t.next=13,r.pushManager.getSubscription();case 13:if(n=t.sent){t.next=17;break}return console.warn("Tidak ada subscription aktif"),t.abrupt("return",!1);case 17:return t.next=19,n.unsubscribe();case 19:return t.next=21,o.A.unsubscribePushNotification({endpoint:n.endpoint},e);case 21:return f("Berhasil menonaktifkan push notification"),localStorage.removeItem("push_subscription_active"),t.abrupt("return",!0);case 26:return t.prev=26,t.t0=t.catch(0),console.error("Error unsubscribing from push notification:",t.t0),l("Gagal menonaktifkan push notification: "+t.t0.message),t.abrupt("return",!1);case 31:case"end":return t.stop()}}),t,null,[[0,26]])})))).apply(this,arguments)}function b(){return"true"===localStorage.getItem("push_subscription_active")}function x(t){for(var e=(t+"=".repeat((4-t.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),r=window.atob(e),n=new Uint8Array(r.length),o=0;o<r.length;++o)n[o]=r.charCodeAt(o);return n}function L(t){for(var e=new Uint8Array(t),r="",n=0;n<e.byteLength;n++)r+=String.fromCharCode(e[n]);return window.btoa(r)}},819:(t,e,r)=>{r.r(e),r.d(e,{getCurrentLocation:()=>a,initMap:()=>o,initMapForStory:()=>i});var n=r(389);function o(t){if(!t)return null;try{if("undefined"==typeof L)return console.error("Leaflet library is not loaded."),null;if(delete L.Icon.Default.prototype._getIconUrl,L.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"}),!n.A.MAP_SERVICE_API_KEY||"YOUR_MAPTILER_API_KEY_HERE"===n.A.MAP_SERVICE_API_KEY){console.error("MapTiler API key is missing. Please check your configuration.");var e=document.getElementById(t);return e&&(e.innerHTML="<p>Map could not be loaded. MapTiler API key is missing.</p>"),null}var r=L.map(t).setView([0,0],2);return L.tileLayer("https://api.maptiler.com/maps/streets/{z}/{x}/{y}.png?key="+n.A.MAP_SERVICE_API_KEY,{attribution:'<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>',maxZoom:18}).addTo(r),r}catch(e){if(console.error("Error initializing map:",e),e.message&&e.message.includes("container")){var o=document.getElementById(t);o?o.innerHTML="<p>Map could not be loaded. Please try again later.</p>":console.error('Map container with ID "'.concat(t,'" not found.'))}return null}}function i(t,e,r){var n=o(t);n&&(L.marker([e,r]).addTo(n).bindPopup("Story location").openPopup(),n.setView([e,r],15))}function a(){return new Promise((function(t,e){navigator.geolocation?navigator.geolocation.getCurrentPosition((function(e){console.log("Location obtained:",e.coords.latitude,e.coords.longitude),t(e)}),(function(t){var r;switch(console.error("Geolocation error:",t),t.code){case t.PERMISSION_DENIED:r="Location permission denied. Please allow location access in your browser settings.";break;case t.POSITION_UNAVAILABLE:r="Location information is unavailable. Please try again.";break;case t.TIMEOUT:r="Location request timed out. Please try again.";break;default:r="An unknown error occurred while getting location."}e(new Error(r))}),{enableHighAccuracy:!0,timeout:1e4,maximumAge:0}):e(new Error("Geolocation is not supported by your browser"))}))}},916:(t,e,r)=>{r.r(e),r.d(e,{createAboutTemplate:()=>o,createErrorTemplate:()=>f,createHomeTemplate:()=>n,createLoadingTemplate:()=>l,createLoginTemplate:()=>s,createNewStoryTemplate:()=>c,createRegisterTemplate:()=>u,createStoryDetailTemplate:()=>a,createStoryItemTemplate:()=>i});var n=function(){return'\n  <section class="hero">\n    <div class="hero__inner">\n      <h1 class="hero__title">Share Your Story</h1>\n      <p class="hero__tagline">Tell us about your Dicoding experience</p>\n    </div>\n  </section>\n\n  <section class="content">\n    <div class="latest">\n      <h2 class="latest__label">Latest Stories</h2>\n      <div class="stories" id="stories"></div>\n      <div class="loading" id="loading"></div>\n    </div>\n  </section>\n'},o=function(){return'\n  <section class="about">\n    <div class="about__inner container">\n      <h2 class="about__title">About Story App</h2>\n      <div class="about__content">\n        <div class="about__image">\n          <img src="./images/jumbotron.jpg" alt="Dicoding Team" class="lazyload">\n        </div>\n        <div class="about__description">\n          <p>Story App is a platform for sharing your experiences at Dicoding. You can post stories with photos and locations to share with others.</p>\n          <p>This application is built with pure JavaScript using the MVP (Model-View-Presenter) pattern and follows accessibility standards.</p>\n        </div>\n      </div>\n    </div>\n  </section>\n'},i=function(t){return'\n  <article class="story-item" tabindex="0">\n    <div class="story-item__header">\n      <h3 class="story-item__name">'.concat(t.name,'</h3>\n      <time class="story-item__date" datetime="').concat(t.createdAt,'">').concat(new Date(t.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),'</time>\n    </div>\n    <div class="story-item__content">\n      <img \n        class="story-item__image lazyload" \n        data-src="').concat(t.photoUrl,'" \n        src="').concat(t.photoUrl,'" \n        alt="').concat(t.name||"Story image",'"\n        onerror="this.onerror=null; this.src=\'./images/logo.png\';"\n      >\n      <p class="story-item__description">').concat(t.description,"</p>\n    </div>\n    ").concat(t.lat&&t.lon?'\n    <div class="story-item__map" id="map-'.concat(t.id,'"></div>\n    '):"",'\n    <div class="story-item__footer">\n      <a href="#/story-detail/').concat(t.id,'" class="story-item__button">Read More</a>\n    </div>\n  </article>\n')},a=function(t){return'\n  <section class="story-detail">\n    <div class="story-detail__header">\n      <h2 class="story-detail__title">'.concat(t.name,'\'s Story</h2>\n      <time class="story-detail__date" datetime="').concat(t.createdAt,'">').concat(new Date(t.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),'</time>\n    </div>\n    <div class="story-detail__content">\n      <img \n        class="story-detail__image" \n        src="').concat(t.photoUrl,'" \n        alt="').concat(t.name||"Story image",'"\n        onerror="this.onerror=null; this.src=\'./images/logo.png\';"\n      >\n      <p class="story-detail__description">').concat(t.description,"</p>\n      ").concat(t.lat&&t.lon?'\n      <div class="story-detail__map" id="map"></div>\n      ':"",'\n    </div>\n    <div class="story-detail__footer">\n      <a href="#/" class="story-detail__button">Back to Home</a>\n    </div>\n  </section>\n')},c=function(){return'\n  <section class="new-story">\n    <h2 class="new-story__title">Add New Story</h2>\n    <form id="storyForm" class="story-form">\n      <div class="form-group">\n        <label for="description">Description</label>\n        <textarea id="description" name="description" required></textarea>\n      </div>\n      <div class="form-group">\n        <label for="photoInput">Photo</label>\n        <input type="file" id="photoInput" name="photo" accept="image/*" capture="environment">\n        \n        <div class="camera-container">\n          \x3c!-- Camera Selection Dropdown --\x3e\n          <div class="camera-select-container" style="display: none;">\n            <label for="cameraSelect">Choose Camera:</label>\n            <select id="cameraSelect" class="camera-select">\n              <option value="">Loading cameras...</option>\n            </select>\n          </div>\n          \n          \x3c!-- Toggle Camera Button --\x3e\n          <button type="button" id="toggleCamera" class="button">Buka Kamera</button>\n          \n          <video id="camera" class="camera" autoplay playsinline style="display: none;"></video>\n          <canvas id="canvas" class="canvas"></canvas>\n          <div class="camera-controls">\n            <button type="button" id="takePhoto" class="button" style="display: none;">Take Photo</button>\n            <button type="button" id="retakePhoto" class="button secondary" style="display: none;">Retake</button>\n          </div>\n        </div>\n      </div>\n      <div class="form-group">\n        <label for="location">Location</label>\n        <div class="map-container" id="map"></div>\n        <button type="button" id="getLocation" class="button">Use Current Location</button>\n        <input type="hidden" id="lat" name="lat">\n        <input type="hidden" id="lon" name="lon">\n      </div>\n      <button type="submit" class="button primary">Submit Story</button>\n    </form>\n  </section>\n'},s=function(){return'\n  <section class="auth">\n    <div class="auth__inner">\n      <h2 class="auth__title">Login</h2>\n      <form id="loginForm" class="auth__form">\n        <div class="form-group">\n          <label for="email">Email</label>\n          <input type="email" id="email" name="email" required>\n        </div>\n        <div class="form-group">\n          <label for="password">Password</label>\n          <input type="password" id="password" name="password" required minlength="8">\n        </div>\n        <button type="submit" class="button primary">Login</button>\n      </form>\n      <p class="auth__link">Don\'t have an account? <a href="#/register">Register here</a></p>\n    </div>\n  </section>\n'},u=function(){return'\n  <section class="auth">\n    <div class="auth__inner">\n      <h2 class="auth__title">Register</h2>\n      <form id="registerForm" class="auth__form">\n        <div class="form-group">\n          <label for="name">Name</label>\n          <input type="text" id="name" name="name" required>\n        </div>\n        <div class="form-group">\n          <label for="email">Email</label>\n          <input type="email" id="email" name="email" required>\n        </div>\n        <div class="form-group">\n          <label for="password">Password</label>\n          <input type="password" id="password" name="password" required minlength="8">\n        </div>\n        <button type="submit" class="button primary">Register</button>\n      </form>\n      <p class="auth__link">Already have an account? <a href="#/login">Login here</a></p>\n    </div>\n  </section>\n'},l=function(){return'\n  <div class="loading" id="loading" style="display: none;">\n    <div class="loading-spinner"></div>\n    <p class="loading__text">Loading...</p>\n  </div>\n'},f=function(t){return'\n  <div class="error">\n    <p class="error__message">'.concat(t,"</p>\n  </div>\n")}}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var i=e[n]={exports:{}};return t[n](i,i.exports,r),i.exports}r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n=r(916),o=r(298),i=r(319);function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(t)}function c(){c=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function f(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{f({},"")}catch(t){f=function(t,e,r){return t[e]=r}}function h(t,e,r,n){var i=e&&e.prototype instanceof w?e:w,a=Object.create(i.prototype),c=new C(n||[]);return o(a,"_invoke",{value:P(t,r,c)}),a}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var d="suspendedStart",v="suspendedYield",y="executing",m="completed",g={};function w(){}function b(){}function x(){}var L={};f(L,s,(function(){return this}));var k=Object.getPrototypeOf,E=k&&k(k(N([])));E&&E!==r&&n.call(E,s)&&(L=E);var _=x.prototype=w.prototype=Object.create(L);function S(t){["next","throw","return"].forEach((function(e){f(t,e,(function(t){return this._invoke(e,t)}))}))}function O(t,e){function r(o,i,c,s){var u=p(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==a(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,c,s)}),(function(t){r("throw",t,c,s)})):e.resolve(f).then((function(t){l.value=t,c(l)}),(function(t){return r("throw",t,c,s)}))}s(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function P(e,r,n){var o=d;return function(i,a){if(o===y)throw Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=j(c,n);if(s){if(s===g)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var u=p(e,r,n);if("normal"===u.type){if(o=n.done?m:v,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=m,n.method="throw",n.arg=u.arg)}}}function j(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,j(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=p(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[s];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(a(e)+" is not iterable")}return b.prototype=x,o(_,"constructor",{value:x,configurable:!0}),o(x,"constructor",{value:b,configurable:!0}),b.displayName=f(x,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,f(t,l,"GeneratorFunction")),t.prototype=Object.create(_),t},e.awrap=function(t){return{__await:t}},S(O.prototype),f(O.prototype,u,(function(){return this})),e.AsyncIterator=O,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new O(h(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},S(_),f(_,l,"Generator"),f(_,s,(function(){return this})),f(_,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),I(r),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;I(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}function s(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function u(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?s(Object(r),!0).forEach((function(e){l(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function l(t,e,r){return(e=function(t){var e=function(t){if("object"!=a(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=a(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==a(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function f(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function h(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){f(i,n,o,a,c,"next",t)}function c(t){f(i,n,o,a,c,"throw",t)}a(void 0)}))}}const p={init:function(t){var e=t.storiesContainer,r=t.loadingContainer,n=t.callbacks;this._storiesContainer=e,this._loadingContainer=r,this._callbacks=n,this._token=(0,i.c4)(),this._callbacks.showLoading(),(0,i.aX)(),this._fetchStories(),this._initOfflineControls()},_fetchStories:function(){var t=arguments,e=this;return h(c().mark((function r(){var n,i,a;return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=t.length>0&&void 0!==t[0]&&t[0],r.prev=1,i=[],!e._token){r.next=9;break}return r.next=6,o.A.getAllStories({token:e._token,location:1,useOffline:n});case 6:i=r.sent,r.next=12;break;case 9:return e._callbacks.navigateToLogin(),e._callbacks.hideLoading(),r.abrupt("return");case 12:a=i.map((function(t){return u(u({},t),{},{isFromOffline:t.isOffline||n||!navigator.onLine})})),e._callbacks.displayStories(a),e._updateOfflineStatus(a),r.next=21;break;case 17:r.prev=17,r.t0=r.catch(1),e._callbacks.showErrorMessage(r.t0.message),(r.t0.message.toLowerCase().includes("unauthorized")||r.t0.message.toLowerCase().includes("token"))&&e._callbacks.navigateToLogin();case 21:return r.prev=21,e._callbacks.hideLoading(),r.finish(21);case 24:case"end":return r.stop()}}),r,null,[[1,17,21,24]])})))()},_initOfflineControls:function(){this._addOfflineControls()},_addOfflineControls:function(){var t=this;this._callbacks.addOfflineControls&&this._callbacks.addOfflineControls({onRefreshOnline:function(){return t._fetchStories(!1)},onViewOffline:function(){return t._fetchStories(!0)},onClearOfflineData:function(){return t._clearOfflineData()},onDeleteOfflineStory:function(e){return t._deleteOfflineStory(e)}})},_updateOfflineStatus:function(t){var e=this;return h(c().mark((function r(){var n,i;return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,o.A.getOfflineStoriesCount();case 3:n=r.sent,i=t.filter((function(t){return!t.isFromOffline})).length,e._callbacks.updateOfflineStatus&&e._callbacks.updateOfflineStatus({offlineCount:n,onlineCount:i,totalCount:t.length,isOnline:navigator.onLine}),r.next=11;break;case 8:r.prev=8,r.t0=r.catch(0),console.error("Failed to update offline status:",r.t0);case 11:case"end":return r.stop()}}),r,null,[[0,8]])})))()},_clearOfflineData:function(){var t=this;return h(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t._callbacks.showLoading&&t._callbacks.showLoading(),e.next=4,o.A.clearOfflineStories();case 4:t._callbacks.showSuccessMessage&&t._callbacks.showSuccessMessage("Offline data cleared successfully"),t._fetchStories(!1),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),t._callbacks.showErrorMessage&&t._callbacks.showErrorMessage("Failed to clear offline data: ".concat(e.t0.message));case 11:return e.prev=11,t._callbacks.hideLoading&&t._callbacks.hideLoading(),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[0,8,11,14]])})))()},_deleteOfflineStory:function(t){var e=this;return h(c().mark((function r(){return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,t){r.next=3;break}throw new Error("Story ID is required");case 3:if(confirm("Are you sure you want to delete this offline story?")){r.next=6;break}return r.abrupt("return");case 6:return e._callbacks.showLoading&&e._callbacks.showLoading(),r.next=9,o.A.deleteOfflineStory(t);case 9:e._callbacks.showSuccessMessage&&e._callbacks.showSuccessMessage("Story deleted from offline storage"),e._fetchStories(!0),r.next=16;break;case 13:r.prev=13,r.t0=r.catch(0),e._callbacks.showErrorMessage&&e._callbacks.showErrorMessage("Failed to delete story: ".concat(r.t0.message));case 16:return r.prev=16,e._callbacks.hideLoading&&e._callbacks.hideLoading(),r.finish(16);case 19:case"end":return r.stop()}}),r,null,[[0,13,16,19]])})))()},searchOfflineStories:function(t){var e=this;return h(c().mark((function r(){var n,i;return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,t&&""!==t.trim()){r.next=4;break}return e._fetchStories(!0),r.abrupt("return");case 4:return e._callbacks.showLoading&&e._callbacks.showLoading(),r.next=7,o.A.searchOfflineStories(t.trim());case 7:n=r.sent,i=n.map((function(t){return u(u({},t),{},{isFromOffline:!0})})),e._callbacks.displayStories&&e._callbacks.displayStories(i),e._callbacks.showSuccessMessage&&0===n.length&&e._callbacks.showSuccessMessage('No offline stories found for "'.concat(t,'"')),r.next=16;break;case 13:r.prev=13,r.t0=r.catch(0),e._callbacks.showErrorMessage&&e._callbacks.showErrorMessage("Search failed: ".concat(r.t0.message));case 16:return r.prev=16,e._callbacks.hideLoading&&e._callbacks.hideLoading(),r.finish(16);case 19:case"end":return r.stop()}}),r,null,[[0,13,16,19]])})))()},onOnline:function(){console.log("📡 Back online - refreshing stories"),this._callbacks.showSuccessMessage&&this._callbacks.showSuccessMessage("Connection restored - refreshing stories"),this._fetchStories(!1)},onOffline:function(){console.log("📱 Gone offline - switching to offline mode"),this._callbacks.showErrorMessage&&this._callbacks.showErrorMessage("You are offline - showing cached stories"),this._fetchStories(!0)},destroy:function(){window.removeEventListener("online",this.onOnline.bind(this)),window.removeEventListener("offline",this.onOffline.bind(this))}},d={render:function(){return"\n      ".concat((0,n.createHomeTemplate)(),"\n      ").concat((0,n.createLoadingTemplate)(),"\n    ")},afterRender:function(){var t=this,e=document.getElementById("stories"),r=document.getElementById("loading");p.init({storiesContainer:e,loadingContainer:r,callbacks:{navigateToLogin:function(){window.location.hash="#/login"},showErrorMessage:function(e){t._showErrorToast(e)},displayStories:function(r){t._displayStories(r,e)},showLoading:function(){t._showLoading(r)},hideLoading:function(){t._hideLoading(r)}}})},_displayStories:function(t,e){var r=this;e.innerHTML="",0!==t.length?t.forEach((function(t){t.photoUrl||(t.photoUrl="./images/logo.png");var n=document.createElement("div");n.innerHTML=r._createStoryItemTemplate(t);var o=n.firstElementChild;e.appendChild(o),t.lat&&t.lon&&setTimeout((function(){document.getElementById("map-".concat(t.id))&&r._initMapForStory("map-".concat(t.id),t.lat,t.lon)}),100)})):e.innerHTML='<p class="empty-message">No stories found</p>'},_createStoryItemTemplate:function(t){return(0,r(916).createStoryItemTemplate)(t)},_initMapForStory:function(t,e,n){(0,r(819).initMapForStory)(t,e,n)},_showLoading:function(t){t&&(t.style.display="flex",t.innerHTML='<div class="loading-spinner"></div>')},_hideLoading:function(t){t&&(t.style.display="none",t.innerHTML="")},_showErrorToast:function(t){var e=document.createElement("div");e.className="error-toast",e.textContent=t,document.body.appendChild(e),setTimeout((function(){e.classList.add("show"),setTimeout((function(){e.classList.remove("show"),setTimeout((function(){document.body.removeChild(e)}),300)}),3e3)}),100)}},v={render:function(){return(0,n.createAboutTemplate)()},afterRender:function(){}};function y(t){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y(t)}function m(){m=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof w?e:w,a=Object.create(i.prototype),c=new C(n||[]);return o(a,"_invoke",{value:P(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",v="completed",g={};function w(){}function b(){}function x(){}var L={};u(L,a,(function(){return this}));var k=Object.getPrototypeOf,E=k&&k(k(N([])));E&&E!==r&&n.call(E,a)&&(L=E);var _=x.prototype=w.prototype=Object.create(L);function S(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function O(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==y(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function P(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=j(c,n);if(s){if(s===g)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?v:p,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=v,n.method="throw",n.arg=u.arg)}}}function j(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,j(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(y(e)+" is not iterable")}return b.prototype=x,o(_,"constructor",{value:x,configurable:!0}),o(x,"constructor",{value:b,configurable:!0}),b.displayName=u(x,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,u(t,s,"GeneratorFunction")),t.prototype=Object.create(_),t},e.awrap=function(t){return{__await:t}},S(O.prototype),u(O.prototype,c,(function(){return this})),e.AsyncIterator=O,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new O(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},S(_),u(_,s,"Generator"),u(_,a,(function(){return this})),u(_,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),I(r),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;I(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}function g(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function w(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){g(i,n,o,a,c,"next",t)}function c(t){g(i,n,o,a,c,"throw",t)}a(void 0)}))}}var b=function(){var t=w(m().mark((function t(){var e;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices){t.next=2;break}throw new Error("Browser API navigator.mediaDevices.enumerateDevices not available");case 2:return t.prev=2,t.next=5,navigator.mediaDevices.getUserMedia({video:!0,audio:!1});case 5:return t.next=7,navigator.mediaDevices.enumerateDevices();case 7:return e=t.sent,t.abrupt("return",e.filter((function(t){return"videoinput"===t.kind})));case 11:throw t.prev=11,t.t0=t.catch(2),console.error("Error getting camera devices:",t.t0),new Error("Could not access camera devices: "+t.t0.message);case 15:case"end":return t.stop()}}),t,null,[[2,11]])})));return function(){return t.apply(this,arguments)}}(),x=function(){var t=w(m().mark((function t(e){var r,n,o;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,b();case 3:if(r=t.sent,e.innerHTML="",0!==r.length){t.next=12;break}return(n=document.createElement("option")).value="",n.textContent="No cameras found",e.appendChild(n),e.disabled=!0,t.abrupt("return");case 12:return r.forEach((function(t,r){var n=document.createElement("option");n.value=t.deviceId,t.label?t.label.toLowerCase().includes("back")||t.label.toLowerCase().includes("rear")||t.label.toLowerCase().includes("environment")?n.textContent="Back Camera":t.label.toLowerCase().includes("front")||t.label.toLowerCase().includes("face")||t.label.toLowerCase().includes("user")?n.textContent="Front Camera":n.textContent=t.label:n.textContent="Camera ".concat(r+1),e.appendChild(n)})),e.disabled=!1,t.abrupt("return",r);case 17:t.prev=17,t.t0=t.catch(0),console.error("Error populating camera select:",t.t0),(o=document.createElement("option")).value="",o.textContent="Error loading cameras",e.innerHTML="",e.appendChild(o),e.disabled=!0;case 26:case"end":return t.stop()}}),t,null,[[0,17]])})));return function(e){return t.apply(this,arguments)}}(),k=function(){var t=w(m().mark((function t(e){var r,n,o,i=arguments;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=i.length>1&&void 0!==i[1]?i[1]:null,navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){t.next=3;break}throw new Error("Browser API navigator.mediaDevices.getUserMedia not available");case 3:return t.prev=3,e.srcObject&&e.srcObject.getTracks().forEach((function(t){return t.stop()})),n={video:r?{deviceId:{exact:r}}:{facingMode:"environment"},audio:!1},t.next=8,navigator.mediaDevices.getUserMedia(n);case 8:return o=t.sent,e.srcObject=o,t.abrupt("return",new Promise((function(t){e.onloadedmetadata=function(){e.play(),t(o)}})));case 13:throw t.prev=13,t.t0=t.catch(3),new Error("Could not access the camera: "+t.t0.message);case 16:case"end":return t.stop()}}),t,null,[[3,13]])})));return function(e){return t.apply(this,arguments)}}(),E=function(t,e){try{if(t.paused||t.ended||!t.srcObject)return console.error("Video is not playing, cannot take photo"),null;var r=t.videoWidth,n=t.videoHeight;return e.width=r,e.height=n,e.getContext("2d").drawImage(t,0,0,r,n),new Promise((function(t){e.toBlob((function(e){if(!e)return console.error("Failed to create blob from canvas"),void t(null);var r=new File([e],"camera-photo.jpg",{type:"image/jpeg"});t(r)}),"image/jpeg",.95)}))}catch(t){return console.error("Error taking photo:",t),null}},_=r(819),S=r(754);function O(t){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},O(t)}function P(){P=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),c=new C(n||[]);return o(a,"_invoke",{value:S(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",v="completed",y={};function m(){}function g(){}function w(){}var b={};u(b,a,(function(){return this}));var x=Object.getPrototypeOf,L=x&&x(x(N([])));L&&L!==r&&n.call(L,a)&&(b=L);var k=w.prototype=m.prototype=Object.create(b);function E(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function _(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==O(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function S(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=j(c,n);if(s){if(s===y)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?v:p,u.arg===y)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=v,n.method="throw",n.arg=u.arg)}}}function j(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,j(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(O(e)+" is not iterable")}return g.prototype=w,o(k,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:g,configurable:!0}),g.displayName=u(w,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,u(t,s,"GeneratorFunction")),t.prototype=Object.create(k),t},e.awrap=function(t){return{__await:t}},E(_.prototype),u(_.prototype,c,(function(){return this})),e.AsyncIterator=_,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new _(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},E(k),u(k,s,"Generator"),u(k,a,(function(){return this})),u(k,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),I(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;I(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function j(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function T(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){j(i,n,o,a,c,"next",t)}function c(t){j(i,n,o,a,c,"throw",t)}a(void 0)}))}}function I(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,C(n.key),n)}}function C(t){var e=function(t){if("object"!=O(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=O(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==O(e)?e:e+""}const N=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.view=e,this.token=(0,i.c4)(),this.photoFile=null,this.activeCameraId=null,this.cameraStream=null,this.view.initializeMap(),(0,i.aX)(),this.prepareCameraButton(),this._setupGlobalListeners()},e=[{key:"_setupGlobalListeners",value:function(){var t=this;this._hashChangeListener=function(){return t.disableCamera()},this._beforeUnloadListener=function(){return t.disableCamera()},window.addEventListener("hashchange",this._hashChangeListener),window.addEventListener("beforeunload",this._beforeUnloadListener),document.addEventListener("page:change",this._hashChangeListener)}},{key:"destroy",value:function(){this.disableCamera(),window.removeEventListener("hashchange",this._hashChangeListener),window.removeEventListener("beforeunload",this._beforeUnloadListener),document.removeEventListener("page:change",this._hashChangeListener),this._hashChangeListener=null,this._beforeUnloadListener=null}},{key:"prepareCameraButton",value:(f=T(P().mark((function t(){var e;return P().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!this.view.cameraSelect){t.next=6;break}return t.next=4,x(this.view.cameraSelect);case 4:(e=t.sent)&&e.length>0&&(this.activeCameraId=e[0].deviceId,console.log("Available cameras:",e.length),this.view.updateCameraSelect(e));case 6:this.view.toggleCameraButton&&(this.view.toggleCameraButton.style.display="block"),t.next=13;break;case 9:t.prev=9,t.t0=t.catch(0),console.error("Camera preparation error:",t.t0),this.view.showCameraFallbackMessage();case 13:case"end":return t.stop()}}),t,this,[[0,9]])}))),function(){return f.apply(this,arguments)})},{key:"enableCamera",value:(l=T(P().mark((function t(){var e;return P().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,k(this.view.camera,this.activeCameraId);case 3:e=t.sent,this.cameraStream=e,this.view.updateCameraUI(!0),console.log("Camera enabled"),t.next=14;break;case 9:t.prev=9,t.t0=t.catch(0),console.error("Camera enable error:",t.t0),(0,S.Ni)("Failed to enable camera: "+t.t0.message),this.view.showCameraFallbackMessage();case 14:case"end":return t.stop()}}),t,this,[[0,9]])}))),function(){return l.apply(this,arguments)})},{key:"disableCamera",value:function(){var t;this.cameraStream&&(this.cameraStream.getTracks().forEach((function(t){return t.stop()})),this.cameraStream=null,this.view.camera&&(t=this.view.camera)&&t.srcObject&&(t.srcObject.getTracks().forEach((function(t){try{t.stop()}catch(t){console.error("Error stopping track:",t)}})),t.srcObject=null,console.log("Camera stream stopped and cleared")),this.view.updateCameraUI(!1),console.log("Camera disabled"))}},{key:"initCamera",value:(u=T(P().mark((function t(){var e,r;return P().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!this.view.cameraSelect){t.next=6;break}return t.next=4,x(this.view.cameraSelect);case 4:(e=t.sent)&&e.length>0&&(this.activeCameraId=e[0].deviceId,console.log("Available cameras:",e.length),this.view.updateCameraSelect(e));case 6:return t.next=8,k(this.view.camera,this.activeCameraId);case 8:r=t.sent,this.cameraStream=r,this.view.takePhotoButton.style.display="block",this.view.retakePhotoButton.style.display="none",this.view.updateCameraUI(!0),t.next=19;break;case 15:t.prev=15,t.t0=t.catch(0),console.error("Camera error:",t.t0),this.view.showCameraFallbackMessage();case 19:case"end":return t.stop()}}),t,this,[[0,15]])}))),function(){return u.apply(this,arguments)})},{key:"onCameraChange",value:(s=T(P().mark((function t(e){return P().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.activeCameraId=e,t.next=3,this.switchCamera(e);case 3:case"end":return t.stop()}}),t,this)}))),function(t){return s.apply(this,arguments)})},{key:"switchCamera",value:(c=T(P().mark((function t(e){var r;return P().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e||console.warn("No camera ID provided, using default"),this.view.showCameraLoading(!0),this.cameraStream&&this.cameraStream.getTracks().forEach((function(t){return t.stop()})),t.next=6,k(this.view.camera,e);case 6:r=t.sent,this.cameraStream=r,this.view.showCameraLoading(!1),console.log("Switched to camera:",e),t.next=17;break;case 12:t.prev=12,t.t0=t.catch(0),console.error("Error switching camera:",t.t0),(0,S.Ni)("Failed to switch camera: "+t.t0.message),this.view.showCameraLoading(!1);case 17:case"end":return t.stop()}}),t,this,[[0,12]])}))),function(t){return c.apply(this,arguments)})},{key:"onTakePhoto",value:(a=T(P().mark((function t(){var e;return P().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,E(this.view.camera,this.view.canvas);case 3:(e=t.sent)?(this.photoFile=e,this.view.showPhoto(!0),console.log("Photo taken successfully:",this.photoFile)):(0,S.Ni)("Failed to take photo. Please try again."),t.next=11;break;case 7:t.prev=7,t.t0=t.catch(0),console.error("Error taking photo:",t.t0),(0,S.Ni)("Error taking photo: "+t.t0.message);case 11:case"end":return t.stop()}}),t,this,[[0,7]])}))),function(){return a.apply(this,arguments)})},{key:"onRetakePhoto",value:function(){this.view.showPhoto(!1),this.photoFile=null}},{key:"onGetLocation",value:(n=T(P().mark((function t(){var e,r,n,o;return P().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,console.log("Getting current location..."),t.next=4,(0,_.getCurrentLocation)();case 4:e=t.sent,r=e.coords,n=r.latitude,o=r.longitude,console.log("Position obtained:",n,o),this.view.updateLocationInputs(n,o),this.view.setMapMarker(n,o,"Your current location"),(0,S.GF)("Location successfully obtained"),t.next=16;break;case 12:t.prev=12,t.t0=t.catch(0),console.error("Geolocation error:",t.t0),(0,S.Ni)(t.t0.message||"Unable to get your location");case 16:return t.prev=16,this.view.hideLocationLoading(),t.finish(16);case 19:case"end":return t.stop()}}),t,this,[[0,12,16,19]])}))),function(){return n.apply(this,arguments)})},{key:"onPhotoInputChange",value:function(){this.photoFile=null,this.view.canvas.style.display="none"}},{key:"onSubmitStory",value:(r=T(P().mark((function t(e){var r,n,i,a;return P().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.description,n=e.photo,i=e.lat,a=e.lon,r&&""!==r.trim()){t.next=4;break}return(0,S.Ni)("Please enter a description"),t.abrupt("return");case 4:if(n){t.next=7;break}return(0,S.Ni)("Please take or upload a photo"),t.abrupt("return");case 7:if(n instanceof File||n instanceof Blob){t.next=11;break}return(0,S.Ni)("Invalid photo format. Please try again."),console.error("Invalid photo format:",n),t.abrupt("return");case 11:if(t.prev=11,this.view.showSubmitLoading(!0),console.log("Sending story with:",{description:r,photo:n,lat:i,lon:a}),!this.token){t.next=19;break}return t.next=17,o.A.addNewStory({description:r,photo:n,lat:i,lon:a},this.token);case 17:t.next=21;break;case 19:return t.next=21,o.A.addNewStoryGuest({description:r,photo:n,lat:i,lon:a});case 21:this.disableCamera(),(0,S.GF)("Story added successfully!"),window.location.hash="#/",t.next=31;break;case 26:t.prev=26,t.t0=t.catch(11),console.error("Error adding story:",t.t0),(0,S.Ni)(t.t0.message||"Failed to add story"),this.view.showSubmitLoading(!1);case 31:case"end":return t.stop()}}),t,this,[[11,26]])}))),function(t){return r.apply(this,arguments)})},{key:"getPhotoFile",value:function(){return this.photoFile}}],e&&I(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n,a,c,s,u,l,f}();function A(t){return A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},A(t)}function F(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,B(n.key),n)}}function B(t){var e=function(t){if("object"!=A(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=A(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==A(e)?e:e+""}var G=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.storyForm=null,this.camera=null,this.canvas=null,this.cameraSelect=null,this.takePhotoButton=null,this.retakePhotoButton=null,this.getLocationButton=null,this.toggleCameraButton=null,this.mapContainer=null,this.photoInput=null,this.latInput=null,this.lonInput=null,this.map=null,this.marker=null,this.presenter=null,this.isCameraActive=!1},e=[{key:"init",value:function(){console.log("Initializing NewView..."),this.storyForm=document.getElementById("storyForm"),this.camera=document.getElementById("camera"),this.canvas=document.getElementById("canvas"),this.cameraSelect=document.getElementById("cameraSelect"),this.takePhotoButton=document.getElementById("takePhoto"),this.retakePhotoButton=document.getElementById("retakePhoto"),this.getLocationButton=document.getElementById("getLocation"),this.toggleCameraButton=document.getElementById("toggleCamera"),this.mapContainer=document.getElementById("map"),this.photoInput=document.getElementById("photoInput"),console.log("photoInput element:",this.photoInput),this.latInput=document.getElementById("lat"),this.lonInput=document.getElementById("lon"),this.presenter=new N(this),this.setupEventListeners()}},{key:"setupEventListeners",value:function(){var t=this;console.log("Setting up event listeners..."),this.cameraSelect&&this.cameraSelect.addEventListener("change",(function(){var e=t.cameraSelect.value;t.presenter.onCameraChange(e)})),this.toggleCameraButton?(console.log("Toggle camera button found"),this.toggleCameraButton.addEventListener("click",(function(){t.isCameraActive?t.presenter.disableCamera():t.presenter.enableCamera()}))):console.warn("Toggle camera button not found"),this.takePhotoButton&&this.takePhotoButton.addEventListener("click",(function(){t.presenter.onTakePhoto()})),this.retakePhotoButton&&this.retakePhotoButton.addEventListener("click",(function(){t.presenter.onRetakePhoto()})),this.getLocationButton&&this.getLocationButton.addEventListener("click",(function(){t.showLocationLoading(),t.presenter.onGetLocation()})),this.storyForm&&this.storyForm.addEventListener("submit",(function(e){var r,n,o;e.preventDefault(),console.log("Form submitted");var i=(null===(r=t.storyForm.querySelector("#description"))||void 0===r?void 0:r.value)||"",a=t.presenter.getPhotoFile();try{a||(console.log("No photo from camera, checking file input"),t.photoInput?(console.log("photoInput files:",t.photoInput.files),t.photoInput.files&&t.photoInput.files.length>0&&(a=t.photoInput.files[0],console.log("Using file from input:",a))):console.warn("photoInput element is null"))}catch(t){console.error("Error accessing file input:",t)}var c=(null===(n=t.latInput)||void 0===n?void 0:n.value)||null,s=(null===(o=t.lonInput)||void 0===o?void 0:o.value)||null;console.log("Submitting story with data:",{description:i,photo:!!a,lat:c,lon:s}),t.presenter.onSubmitStory({description:i,photo:a,lat:c,lon:s})})),this.photoInput||(console.warn("photoInput not found on initial load, trying again"),this.photoInput=document.getElementById("photoInput")),this.photoInput?(console.log("Adding change event listener to photoInput"),this.photoInput.addEventListener("change",(function(e){console.log("Photo input changed:",e);try{t.photoInput.files&&t.photoInput.files.length>0&&(console.log("File selected:",t.photoInput.files[0]),t.presenter.onPhotoInputChange())}catch(t){console.error("Error in photoInput change event:",t)}}))):console.error('PhotoInput element still not found with ID "photoInput"')}},{key:"showPhoto",value:function(t){this.canvas&&this.camera&&this.takePhotoButton&&this.retakePhotoButton&&(this.canvas.style.display=t?"block":"none",this.camera.style.display=t?"none":"block",this.takePhotoButton.style.display=t?"none":"block",this.retakePhotoButton.style.display=t?"block":"none",this.cameraSelect&&(this.cameraSelect.parentElement.style.display=t?"none":"block"))}},{key:"updateCameraUI",value:function(t){this.isCameraActive=t,this.toggleCameraButton&&(this.toggleCameraButton.textContent=t?"Tutup Kamera":"Buka Kamera"),this.camera&&(this.camera.style.display=t?"block":"none"),this.takePhotoButton&&(this.takePhotoButton.style.display=t?"block":"none"),this.cameraSelect&&this.cameraSelect.parentElement&&(this.cameraSelect.parentElement.style.display=t?"block":"none")}},{key:"initializeMap",value:function(){var t=this;try{return this.mapContainer?"undefined"==typeof L?(console.error("Leaflet library is not defined"),this.mapContainer.innerHTML='<p class="map-error">Map could not be loaded. Please refresh the page or try again later.</p>',null):(this.map=L.map(this.mapContainer.id).setView([0,0],2),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(this.map),this.map.on("click",(function(e){var r=e.latlng,n=r.lat,o=r.lng;t.updateLocationInputs(n,o),t.setMapMarker(n,o,"Story location")})),this.map):(console.error("Map container element is not defined"),null)}catch(t){return console.error("Error initializing map:",t),this.mapContainer&&(this.mapContainer.innerHTML='<p class="map-error">Map could not be loaded. Please try again later.</p>'),null}}},{key:"setMapMarker",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Location";this.map&&(this.marker&&this.map.removeLayer(this.marker),this.marker=L.marker([t,e]).addTo(this.map).bindPopup(r).openPopup(),this.map.setView([t,e],15))}},{key:"updateLocationInputs",value:function(t,e){this.latInput&&(this.latInput.value=t),this.lonInput&&(this.lonInput.value=e)}},{key:"showCameraLoading",value:function(t){this.takePhotoButton&&(this.takePhotoButton.disabled=t,this.takePhotoButton.textContent=t?"Switching camera...":"Take Photo"),this.cameraSelect&&(this.cameraSelect.disabled=t)}},{key:"showLocationLoading",value:function(){this.getLocationButton&&(this.getLocationButton.disabled=!0,this.getLocationButton.textContent="Getting location...")}},{key:"hideLocationLoading",value:function(){this.getLocationButton&&(this.getLocationButton.disabled=!1,this.getLocationButton.textContent="Use Current Location")}},{key:"showSubmitLoading",value:function(t){if(this.storyForm){var e=this.storyForm.querySelector('button[type="submit"]');e&&(e.disabled=t,e.textContent=t?"Submitting...":"Submit Story")}}},{key:"showCameraFallbackMessage",value:function(){if(this.camera){this.camera&&(this.camera.style.display="none"),this.takePhotoButton&&(this.takePhotoButton.style.display="none"),this.retakePhotoButton&&(this.retakePhotoButton.style.display="none"),this.cameraSelect&&this.cameraSelect.parentElement&&(this.cameraSelect.parentElement.style.display="none"),this.toggleCameraButton&&(this.toggleCameraButton.style.display="none"),this.photoInput&&(this.photoInput.style.display="block");var t=document.createElement("p");t.textContent="Camera not available. Please upload a photo instead.",t.className="camera-fallback-message",this.camera.parentNode&&this.camera.parentNode.insertBefore(t,this.camera)}}},{key:"updateCameraSelect",value:function(t){this.cameraSelect&&this.cameraSelect.parentElement&&(t&&t.length>0?1===t.length?this.cameraSelect.parentElement.style.display="none":this.cameraSelect.parentElement.style.display="block":this.cameraSelect.parentElement.style.display="none")}},{key:"destroy",value:function(){this.presenter&&(this.presenter.destroy(),this.presenter=null)}}],e&&F(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function M(t){var e=t.split("/");return{resource:e[1]||null,id:e[2]||null}}function D(){return location.hash.replace("#","")||"/"}function R(t){return R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},R(t)}function U(){U=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),c=new T(n||[]);return o(a,"_invoke",{value:S(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",v="completed",y={};function m(){}function g(){}function w(){}var b={};u(b,a,(function(){return this}));var x=Object.getPrototypeOf,L=x&&x(x(I([])));L&&L!==r&&n.call(L,a)&&(b=L);var k=w.prototype=m.prototype=Object.create(b);function E(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function _(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==R(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function S(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=O(c,n);if(s){if(s===y)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?v:p,u.arg===y)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=v,n.method="throw",n.arg=u.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function j(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(R(e)+" is not iterable")}return g.prototype=w,o(k,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:g,configurable:!0}),g.displayName=u(w,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,u(t,s,"GeneratorFunction")),t.prototype=Object.create(k),t},e.awrap=function(t){return{__await:t}},E(_.prototype),u(_.prototype,c,(function(){return this})),e.AsyncIterator=_,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new _(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},E(k),u(k,s,"Generator"),u(k,a,(function(){return this})),u(k,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(j),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),j(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;j(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function Y(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}const H={init:function(t){var e=t.view;this._view=e,this._token=(0,i.c4)(),this._storyId=M(D()).id,this._view.showLoading(),this._fetchStoryDetail()},_fetchStoryDetail:function(){var t,e=this;return(t=U().mark((function t(){var r;return U().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,o.A.getStoryDetail(e._storyId,e._token);case 3:(r=t.sent).photoUrl||(r.photoUrl="./images/logo.png"),e._displayStory(r),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(0),(0,S.Ni)(t.t0.message),e._view.redirectToHome();case 12:return t.prev=12,e._view.hideLoading(),t.finish(12);case 15:case"end":return t.stop()}}),t,null,[[0,8,12,15]])})),function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Y(i,n,o,a,c,"next",t)}function c(t){Y(i,n,o,a,c,"throw",t)}a(void 0)}))})()},_displayStory:function(t){var e=(0,n.createStoryDetailTemplate)(t);this._view.renderStory(e),t.lat&&t.lon&&this._view.initMap(t)}};var V={render:function(){return'\n      <div id="story-detail-container" class="story-detail-container"></div>\n      '.concat((0,n.createLoadingTemplate)(),"\n    ")},afterRender:function(){var t={container:document.getElementById("story-detail-container"),loadingElement:document.querySelector(".loading"),showLoading:function(){this.loadingElement.style.display="flex"},hideLoading:function(){this.loadingElement.style.display="none"},renderStory:function(t){this.container.innerHTML=t},initMap:function(t){var e=this;t.lat&&t.lon&&setTimeout((function(){var r=document.getElementById("map");if(r){var n=e._initMapElement(r);n&&window.L&&(window.L.marker([t.lat,t.lon]).addTo(n).bindPopup("Story location").openPopup(),n.setView([t.lat,t.lon],15))}}),100)},_initMapElement:function(t){return(0,r(819).initMap)(t)},redirectToHome:function(){window.location.hash="#/"}};H.init({view:t})}};function q(t){return q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},q(t)}function z(){z=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),c=new T(n||[]);return o(a,"_invoke",{value:S(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",v="completed",y={};function m(){}function g(){}function w(){}var b={};u(b,a,(function(){return this}));var x=Object.getPrototypeOf,L=x&&x(x(I([])));L&&L!==r&&n.call(L,a)&&(b=L);var k=w.prototype=m.prototype=Object.create(b);function E(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function _(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==q(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function S(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=O(c,n);if(s){if(s===y)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?v:p,u.arg===y)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=v,n.method="throw",n.arg=u.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function j(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(q(e)+" is not iterable")}return g.prototype=w,o(k,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:g,configurable:!0}),g.displayName=u(w,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,u(t,s,"GeneratorFunction")),t.prototype=Object.create(k),t},e.awrap=function(t){return{__await:t}},E(_.prototype),u(_.prototype,c,(function(){return this})),e.AsyncIterator=_,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new _(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},E(k),u(k,s,"Generator"),u(k,a,(function(){return this})),u(k,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(j),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),j(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;j(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function W(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}const K={init:function(t){var e=t.loginForm,r=t.callbacks;this._loginForm=e,this._callbacks=r,this._setupEventListeners()},_setupEventListeners:function(){var t=this;this._loginForm.addEventListener("submit",function(){var e,r=(e=z().mark((function e(r){var n,a,c;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.preventDefault(),t._callbacks.setLoadingState(),n=t._loginForm.querySelector("#email").value,a=t._loginForm.querySelector("#password").value,e.prev=4,e.next=7,o.A.login({email:n,password:a});case 7:if((c=e.sent).loginResult&&c.loginResult.token){e.next=10;break}throw new Error("Invalid login response. Token not found.");case 10:(0,i.O5)(c.loginResult.token),(0,i.gV)({id:c.loginResult.userId,name:c.loginResult.name}),t._callbacks.navigateToHome(),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(4),t._callbacks.showErrorMessage(e.t0.message);case 18:return e.prev=18,t._callbacks.setDefaultState(),e.finish(18);case 21:case"end":return e.stop()}}),e,null,[[4,15,18,21]])})),function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(t){W(i,n,o,a,c,"next",t)}function c(t){W(i,n,o,a,c,"throw",t)}a(void 0)}))});return function(t){return r.apply(this,arguments)}}())}};function J(t){return J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},J(t)}function X(){X=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),c=new T(n||[]);return o(a,"_invoke",{value:S(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",v="completed",y={};function m(){}function g(){}function w(){}var b={};u(b,a,(function(){return this}));var x=Object.getPrototypeOf,L=x&&x(x(I([])));L&&L!==r&&n.call(L,a)&&(b=L);var k=w.prototype=m.prototype=Object.create(b);function E(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function _(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==J(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function S(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=O(c,n);if(s){if(s===y)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?v:p,u.arg===y)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=v,n.method="throw",n.arg=u.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function j(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(J(e)+" is not iterable")}return g.prototype=w,o(k,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:g,configurable:!0}),g.displayName=u(w,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,u(t,s,"GeneratorFunction")),t.prototype=Object.create(k),t},e.awrap=function(t){return{__await:t}},E(_.prototype),u(_.prototype,c,(function(){return this})),e.AsyncIterator=_,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new _(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},E(k),u(k,s,"Generator"),u(k,a,(function(){return this})),u(k,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(j),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),j(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;j(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function $(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}const Q={init:function(t){var e=t.registerForm,r=t.callbacks;this._registerForm=e,this._callbacks=r,this._setupEventListeners()},_setupEventListeners:function(){var t=this;this._registerForm.addEventListener("submit",function(){var e,r=(e=X().mark((function e(r){var n,i,a;return X().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.preventDefault(),n=t._registerForm.querySelector("#name").value,i=t._registerForm.querySelector("#email").value,a=t._registerForm.querySelector("#password").value,e.prev=4,e.next=7,o.A.register({name:n,email:i,password:a});case 7:t._callbacks.showSuccessMessage("Registration successful! Please login."),t._callbacks.navigateToLogin(),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),t._callbacks.showErrorMessage(e.t0.message);case 14:case"end":return e.stop()}}),e,null,[[4,11]])})),function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(t){$(i,n,o,a,c,"next",t)}function c(t){$(i,n,o,a,c,"throw",t)}a(void 0)}))});return function(t){return r.apply(this,arguments)}}())}},Z={"/":d,"/about":v,"/new":{render:function(){return(0,n.createNewStoryTemplate)()},afterRender:function(){console.log("NewPage afterRender called");var t=new G;t.init(),window._viewInstances||(window._viewInstances={}),window._viewInstances.newView&&window._viewInstances.newView.destroy(),window._viewInstances.newView=t;var e=function(){window._viewInstances.newView&&(console.log("Cleaning up NewView instance"),window._viewInstances.newView.destroy()),window.removeEventListener("hashchange",e),document.dispatchEvent(new CustomEvent("page:change"))};window.addEventListener("hashchange",e),setTimeout((function(){var t=document.getElementById("photoInput");console.log("photoInput check after timeout:",t)}),100)},beforeLeave:function(){window._viewInstances&&window._viewInstances.newView&&(console.log("Executing beforeLeave cleanup for NewPage"),window._viewInstances.newView.destroy(),window._viewInstances.newView=null)}},"/story-detail/:id":V,"/login":{render:function(){return(0,n.createLoginTemplate)()},afterRender:function(){var t=this,e=document.getElementById("loginForm"),r=e.querySelector('button[type="submit"]');K.init({loginForm:e,callbacks:{setLoadingState:function(){r.disabled=!0,r.textContent="Logging in..."},setDefaultState:function(){r.disabled=!1,r.textContent="Login"},navigateToHome:function(){window.location.hash="#/"},showErrorMessage:function(e){t._showErrorToast(e)}}})},_showErrorToast:function(t){var e=document.createElement("div");e.className="error-toast",e.textContent=t,document.body.appendChild(e),setTimeout((function(){e.classList.add("show"),setTimeout((function(){e.classList.remove("show"),setTimeout((function(){document.body.removeChild(e)}),300)}),3e3)}),100)}},"/register":{render:function(){return(0,n.createRegisterTemplate)()},afterRender:function(){var t=this,e=document.getElementById("registerForm");Q.init({registerForm:e,callbacks:{navigateToLogin:function(){window.location.hash="#/login"},showSuccessMessage:function(e){t._showSuccessToast(e)},showErrorMessage:function(e){t._showErrorToast(e)}}})},_showSuccessToast:function(t){var e=document.createElement("div");e.className="success-toast",e.textContent=t,document.body.appendChild(e),setTimeout((function(){e.classList.add("show"),setTimeout((function(){e.classList.remove("show"),setTimeout((function(){document.body.removeChild(e)}),300)}),3e3)}),100)},_showErrorToast:function(t){var e=document.createElement("div");e.className="error-toast",e.textContent=t,document.body.appendChild(e),setTimeout((function(){e.classList.add("show"),setTimeout((function(){e.classList.remove("show"),setTimeout((function(){document.body.removeChild(e)}),300)}),3e3)}),100)}}};var tt=r(639);function et(t){return et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},et(t)}function rt(){rt=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),c=new T(n||[]);return o(a,"_invoke",{value:S(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",v="completed",y={};function m(){}function g(){}function w(){}var b={};u(b,a,(function(){return this}));var x=Object.getPrototypeOf,L=x&&x(x(I([])));L&&L!==r&&n.call(L,a)&&(b=L);var k=w.prototype=m.prototype=Object.create(b);function E(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function _(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==et(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function S(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=O(c,n);if(s){if(s===y)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?v:p,u.arg===y)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=v,n.method="throw",n.arg=u.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function j(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(et(e)+" is not iterable")}return g.prototype=w,o(k,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:g,configurable:!0}),g.displayName=u(w,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,u(t,s,"GeneratorFunction")),t.prototype=Object.create(k),t},e.awrap=function(t){return{__await:t}},E(_.prototype),u(_.prototype,c,(function(){return this})),e.AsyncIterator=_,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new _(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},E(k),u(k,s,"Generator"),u(k,a,(function(){return this})),u(k,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(j),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),j(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;j(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function nt(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function ot(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,it(n.key),n)}}function it(t){var e=function(t){if("object"!=et(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=et(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==et(e)?e:e+""}function at(t,e,r){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,r)}function ct(t,e){return t.get(ut(t,e))}function st(t,e,r){return t.set(ut(t,e),r),r}function ut(t,e,r){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:r;throw new TypeError("Private element is not present on this object")}var lt=new WeakMap,ft=new WeakMap,ht=new WeakMap,pt=new WeakMap;const dt=function(){return t=function t(e){var r=e.navigationDrawer,n=e.drawerButton,o=e.content;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),at(this,lt,null),at(this,ft,null),at(this,ht,null),at(this,pt,null),st(lt,this,o),st(ft,this,n),st(ht,this,r),st(pt,this,document.querySelector(".skip-link")),this._setupDrawer(),this._setupSkipLink(),this._initNotificationToggle()},e=[{key:"_setupDrawer",value:function(){var t=this;ct(ft,this).addEventListener("click",(function(){ct(ht,t).classList.toggle("open")})),document.body.addEventListener("click",(function(e){ct(ht,t).contains(e.target)||ct(ft,t).contains(e.target)||ct(ht,t).classList.remove("open"),ct(ht,t).querySelectorAll("a").forEach((function(r){r.contains(e.target)&&ct(ht,t).classList.remove("open")}))}))}},{key:"_setupSkipLink",value:function(){var t=this;ct(pt,this)&&ct(pt,this).addEventListener("click",(function(e){e.preventDefault(),ct(pt,t).blur(),ct(lt,t).focus(),ct(lt,t).scrollIntoView()}))}},{key:"_initNotificationToggle",value:function(){var t=(0,i.c4)(),e=document.getElementById("notification-container");if(e)if(t){if(e.style.display="block",!document.getElementById("notification-toggle-btn")){var r=(0,tt.createNotificationToggle)();e.innerHTML=r,setTimeout((function(){(0,tt.initNotificationToggle)()}),100)}}else e.style.display="none",e.innerHTML=""}},{key:"renderPage",value:(r=rt().mark((function t(){var e,r=this;return rt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=M(D()),o=void 0,o="",n.resource&&(o=o.concat("/".concat(n.resource))),n.id&&(o=o.concat("/:id")),e=Z[o||"/"]){t.next=5;break}return ct(lt,this).innerHTML="<h1>Page Not Found</h1>",t.abrupt("return");case 5:if(!document.startViewTransition){t.next=9;break}document.startViewTransition((function(){ct(lt,r).innerHTML=e.render(),e.afterRender(),r._initNotificationToggle()})),t.next=13;break;case 9:return ct(lt,this).innerHTML=e.render(),t.next=12,e.afterRender();case 12:this._initNotificationToggle();case 13:case"end":return t.stop()}var n,o}),t,this)})),n=function(){var t=this,e=arguments;return new Promise((function(n,o){var i=r.apply(t,e);function a(t){nt(i,n,o,a,c,"next",t)}function c(t){nt(i,n,o,a,c,"throw",t)}a(void 0)}))},function(){return n.apply(this,arguments)})}],e&&ot(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n}();var vt=r(659);function yt(){yt=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),c=new T(n||[]);return o(a,"_invoke",{value:S(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",v="completed",y={};function m(){}function g(){}function w(){}var b={};u(b,a,(function(){return this}));var x=Object.getPrototypeOf,L=x&&x(x(I([])));L&&L!==r&&n.call(L,a)&&(b=L);var k=w.prototype=m.prototype=Object.create(b);function E(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function _(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==mt(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function S(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=O(c,n);if(s){if(s===y)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?v:p,u.arg===y)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=v,n.method="throw",n.arg=u.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function j(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(mt(e)+" is not iterable")}return g.prototype=w,o(k,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:g,configurable:!0}),g.displayName=u(w,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,u(t,s,"GeneratorFunction")),t.prototype=Object.create(k),t},e.awrap=function(t){return{__await:t}},E(_.prototype),u(_.prototype,c,(function(){return this})),e.AsyncIterator=_,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new _(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},E(k),u(k,s,"Generator"),u(k,a,(function(){return this})),u(k,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(j),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),j(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;j(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function mt(t){return mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mt(t)}function gt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Lt(n.key),n)}}function wt(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function bt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function xt(t,e,r){return(e=Lt(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Lt(t){var e=function(t){if("object"!=mt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=mt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==mt(e)?e:e+""}function kt(){return(t=yt().mark((function t(){return yt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,vt.A.init();case 3:return console.log("✅ IndexedDB initialized successfully"),t.abrupt("return",!0);case 7:return t.prev=7,t.t0=t.catch(0),console.error("❌ Failed to initialize IndexedDB:",t.t0),t.abrupt("return",!1);case 11:case"end":return t.stop()}}),t,null,[[0,7]])})),kt=function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){wt(i,n,o,a,c,"next",t)}function c(t){wt(i,n,o,a,c,"throw",t)}a(void 0)}))}).apply(this,arguments);var t}function Et(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=document.getElementById("offline-indicator");e&&(e.style.display=t||!navigator.onLine?"block":"none",e.textContent=t?"📱 Offline Mode":"🌐 Online")}function _t(t){return _t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_t(t)}function St(){St=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),c=new T(n||[]);return o(a,"_invoke",{value:S(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",v="completed",y={};function m(){}function g(){}function w(){}var b={};u(b,a,(function(){return this}));var x=Object.getPrototypeOf,L=x&&x(x(I([])));L&&L!==r&&n.call(L,a)&&(b=L);var k=w.prototype=m.prototype=Object.create(b);function E(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function _(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==_t(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function S(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=O(c,n);if(s){if(s===y)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?v:p,u.arg===y)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=v,n.method="throw",n.arg=u.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function j(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(_t(e)+" is not iterable")}return g.prototype=w,o(k,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:g,configurable:!0}),g.displayName=u(w,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,u(t,s,"GeneratorFunction")),t.prototype=Object.create(k),t},e.awrap=function(t){return{__await:t}},E(_.prototype),u(_.prototype,c,(function(){return this})),e.AsyncIterator=_,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new _(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},E(k),u(k,s,"Generator"),u(k,a,(function(){return this})),u(k,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(j),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),j(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;j(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function Ot(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function Pt(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Ot(i,n,o,a,c,"next",t)}function c(t){Ot(i,n,o,a,c,"throw",t)}a(void 0)}))}}new(function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.metrics={}},(e=[{key:"start",value:function(t){this.metrics[t]={startTime:performance.now(),operation:t}}},{key:"end",value:function(t){if(this.metrics[t]){var e=performance.now(),r=e-this.metrics[t].startTime;return console.log("📊 ".concat(t," completed in ").concat(r.toFixed(2),"ms")),this.metrics[t].endTime=e,this.metrics[t].duration=r,r}return null}},{key:"getMetrics",value:function(){return function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?bt(Object(r),!0).forEach((function(e){xt(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):bt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},this.metrics)}},{key:"clear",value:function(){this.metrics={}}}])&&gt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}());var jt,Tt=new dt({navigationDrawer:document.getElementById("navigation-drawer"),drawerButton:document.getElementById("drawer-button"),content:document.getElementById("main-content")});function It(){return Ct.apply(this,arguments)}function Ct(){return(Ct=Pt(St().mark((function t(){return St().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(0,i.c4)()&&(localStorage.getItem("push_subscription_active")||setTimeout(Pt(St().mark((function t(){return St().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,S.$R)();case 3:t.next=8;break;case 5:t.prev=5,t.t0=t.catch(0),console.error("Auto-subscribe push notification gagal:",t.t0);case 8:case"end":return t.stop()}}),t,null,[[0,5]])}))),2e3));case 2:case"end":return t.stop()}}),t)})))).apply(this,arguments)}window.addEventListener("hashchange",(function(){(0,i.aX)(),Tt.renderPage()})),window.addEventListener("load",Pt(St().mark((function t(){return St().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(0,i.aX)(),Tt.renderPage(),t.next=4,It();case 4:case"end":return t.stop()}}),t)})))),window.addEventListener("online",(function(){console.log("Aplikasi kembali online"),It()})),window.addEventListener("offline",(function(){console.log("Aplikasi sedang offline")})),"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",(function(t){t.data&&"NOTIFICATION_CLICKED"===t.data.type&&(console.log("Notification clicked:",t.data),t.data.storyId?window.location.hash="#/story-detail/".concat(t.data.storyId):t.data.url&&(window.location.hash=t.data.url))})),document.addEventListener("DOMContentLoaded",(function(){Promise.resolve().then(r.bind(r,639)).then((function(t){var e=t.initNotificationToggle;setTimeout((function(){e()}),100)})).catch((function(t){console.error("Error loading notification toggle:",t)}))})),function(){kt.apply(this,arguments)}(),(jt=document.getElementById("offline-indicator"))||((jt=document.createElement("div")).id="offline-indicator",jt.style.cssText="\n      position: fixed;\n      top: 10px;\n      right: 10px;\n      background: #333;\n      color: white;\n      padding: 8px 12px;\n      border-radius: 4px;\n      font-size: 12px;\n      z-index: 1000;\n      display: none;\n    ",document.body.appendChild(jt)),Et(!navigator.onLine),window.addEventListener("online",(function(){return Et(!1)})),window.addEventListener("offline",(function(){return Et(!0)}))})();